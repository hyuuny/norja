# ✈️ norja

> 코틀린을 학습하면서, 멀티 모듈을 통해 각 도메인은 독립적으로 필요한 최소 의존성만을 갖는 숙박 예약 시스템 API를 구현해보았습니다.

<br>

## 사용 기술

언어
- `Kotlin`

프레임워크
- `Spring Boot`, `Spring Data JPA`, `Spring Security`

데이터베이스
- `MySQL 5.7`, `H2`

서드파티
- `Redis`, `OpenAPI`, `JWT`

<br>

## 기술 사용 목적

### Kotlin
코틀린 학습을 위해 API를 개발해본 결과, 자바에서 롬복을 통해 습관적으로 사용하게 되는 @Getter, @Setter등을 선언하지 않고도 DataClass를 이용하여 처리가 가능했고, 변수에 “?”를 선언하지 않으면 null 자체를 할당할 수 없기 때문에 NPE로부터 안전하였습니다. 그로 인해 안정성있고, 간결한 코드로 가독성이 높아지게 되었습니다.

<br>

### Spring Data JPA & Querydsl
JPA로 기본적인 CRUD를 처리하고, Querydsl을 이용하여 페이징과 검색과 같은 복잡한 쿼리를 작성하기 위해 사용하였습니다. 

프로그램을 작성하면서 단순 반복되는 CRUD를 작성하지 않고, 좀 더 비지니스 로직에 집중할 수 있었습니다. 또한, MyBatis를 사용한다면 필드가 추가되었을 때, SQL Query에도 직접 해당 필드를 추가해야 하지만 JPA를 사용하면 추가하지 않아도 처리가 가능해서 편하게 사용할 수 있었습니다.

<br>

### Spring Security & JWT
사용자의 인증 및 인가 처리를 위해 사용하였습니다. 

로그인 된 사용자만이 이용할 수 있는 API에 일일이 인증 로직을 추가하지 않고, 헤더에 넘어온 token 값으로 올바른 사용자인지 확인하여 처리할 수 있었습니다. 

<br>

### Redis
데이터 캐싱 용도로 사용하였습니다. 

사용자의 요청이 주로 몰리는 숙박업체나 방 조회 데이터를 캐싱하여 저장해놓고, 해당 값을 조회하는 요청이 들어왔을 때,  DB에서 값을 조회할 필요 없이 결과를 반환하도록 하였습니다. 그로 인해 자원을 아끼고, 속도 최적화가 가능하였습니다. 

<br>

### OpenAPI
API 스펙 문서 및 인수 테스트 목적으로 사용하였습니다. 

각 API 마다 필요한 요청 값과 반환 값을 수월하게 문서처럼 정리할 수 있었고, 단위 테스트 및 통합 테스트와 별도로 직접 올바른 값과 잘못된 값을 넣어보며, 실제 API 테스트를 진행하였습니다.

<br>

## 요구사항

### 숙박업체
- 숙박업체 목록을 조회할 수 있어야 한다.
  - 분류별로 조회할 수 있어야 한다.(호텔, 모텔, 호캉스 등)
  - 주소로 조회할 수 있어야 한다.
  - 목록에 후기 개수 및 평균을 조회할 수 있어야 한다.
  - 기간으로 남은 객실의 수를 알 수 있어야 한다.
- 숙박업체를 등록할 수 있어야 한다.
- 숙박업체를 조회할 수 있어야 한다.
  - 잘못된 숙박업체를 조회 요청 했을 때, 예외 메세지를 반환해야 한다.
- 숙박업체를 수정할 수 있어야한다.
  - 잘못된 숙박업체를 수정 요청 했을 때, 예외 메세지를 반환해야 한다.
- 숙박업체의 휴무를 설정할 수 있어야 한다.
- 숙박업체를 삭제할 수 있어야 한다.

<br>

### 객실
- 객실을 등록할 수 있어야 한다.
- 객실을 조회할 수 있어야 한다.
  - 잘못된 객실을 조회 요청 했을 때, 예외 메세지를 반환해야 한다.
- 객실을 수정할 수 있어야 한다.
  - 잘못된 객실을 수정 요청 했을 때, 예외 메세지를 반환해야 한다.
- 객실을 삭제할 수 있어야 한다.

<br>

### 예약
- 예약 목록을 조회할 수 있어야 한다.
  - 특정 고객으로 조회할 수 있어야 한다.
  - 기간으로 조회할 수 있어야 한다.
  - 상태로 조회할 수 있어야 한다.
- 예약을 조회할 수 있어야 한다.
- 예약을 등록 할 수 있어야 한다.
  - 기간 내 남은 객실이 없다면, 예외 메세지를 반환해야 한다.
  - 잘못된 예약내역을 조회 요청 햤을 때, 예외 메세지를 반환해야 한다.
- 예약을 취소할 수 있어야 한다.
  - 잘못된 예약내역을 취소 요청 했을 때, 예외 메세지를 반환해야 한다.


<br>

### 후기
- 후기 목록을 조회할 수 있어야 한다.
  - 숙박 업체에 등록된 후기를 조회할 수 있어야 한다.
  - 객실에 등록된 후기를 조회할 수 있어야 한다.
  - 특정 고객이 등록한 후기를 조회할 수 있어야 한다.
  - 타입으로 조회할 수 있어야 한다.
  - 전체 평점을 기준으로 조회할 수 있어야 한다.
  - 베스트 여부로 조회할 수 있어야 한다.
- 후기를 등록할 수 있어야 한다.
- 후기를 조회할 수 있어야 한다.
  - 잘못된 후기를 조회 요청 했을 때, 예외 메세지를 반환해야 한다.
- 후기를 삭제할 수 있어야 한다.
- 후기를 베스트 설정/해제 설정할 수 있어야 한다.
- 숙박업체에 등록된 후기 평균 점수를 조회할 수 있어야 한다.

<br>

### 카테고리

- 카테고리 목록을 조회할 수 있어야 한다.
- 부모/자녀카테고리를 등록할 수 있어야 한다.
- 부모/자녀 카테고리를 조회할 수 있어야 한다.
  - 잘못된 카테고리를 조회 요청 했을 때, 예외 메세지를 반환해야 한다.
- 카테고리를 수정할 수 있어야 한다.
- 카테고리를 삭제할 수 있어야 한다.

<br>

### 회원
- 회원 목록을 조회할 수 있어야 한다.
  - 특정 고객을 조회할 수 있어야 한다.
  - 상태롤 조회할 수 있어야 한다.
- 로그인할 수 있어야 한다.
- 회원가입 할 수 있어야 한다.
- 고객을 조회할 수 있어야 한다.
  - 잘못된 고객을 조회 요청 했을 때, 예외 메세지를 반환해야 한다.
- 비밀번호를 변경할 수 있어야 한다.
- 동의 여부를 변경할 수 있어야 한다.
- 회원 정보를 변경할 수 있어야 한다.
- 회원 탈퇴를 할 수 있어야 한다.

## 퀵 스타트

- docker-compose 컨테이너 생성

```shell
$ docker compose up -d
```

<br>

- 관리자 Swagger 접속
    - NorjaAdminApplication 실행
    - `localhost:8081/swagger-ui.html` 접속

<br>

- 사용자 Swagger 접속
    - NorjaApplication 실행
    - `localhost:8081/swagger-ui.html` 접속
    - 회원가입 -> 로그인 후, `accessToken` 값 상단의 `Authorize`에 입력

```json
{
  "token": {
    "accessToken": "eyJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiSldUIiwiYWxnIjoiSFMyNTYiLCJ1c2VybmFtZSI6Imh5dXVueUBrbm91LmFjLmtyIiwiZXhwIjoxNjYzMTMyNDc5fQ.FaceuQijnJtyR3w8moqbS_s49tZROwtBAD5eWIWsNMU"
  }
}
```

<br>

## 구조

<img width="100%" alt="스크린샷 2022-09-19 오전 11 29 23" src="https://user-images.githubusercontent.com/69466533/190941191-fbf1f4fd-7e2e-4ec3-b96c-d1814666b49d.png">

